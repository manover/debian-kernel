commit b8c0d911ac5285e6be8967713271a51bdc5a936a
Author: Eric Wheeler <git@linux.ewheeler.net>
Date:   Sun Oct 23 18:19:20 2016 -0700

    bcache: partition support: add 16 minors per bcacheN device
    
    Signed-off-by: Eric Wheeler <bcache@linux.ewheeler.net>
    Tested-by: Wido den Hollander <wido@widodh.nl>

--- a/drivers/md/bcache/super.c
+++ b/drivers/md/bcache/super.c
@@ -63,6 +63,7 @@ static wait_queue_head_t unregister_wait
 struct workqueue_struct *bcache_wq;
 
 #define BTREE_MAX_PAGES		(256 * 1024 / PAGE_SIZE)
+#define BCACHE_MINORS		16 /* partition support */
 
 /* Superblock */
 
@@ -788,8 +789,10 @@ static int bcache_device_init(struct bca
 	if (minor < 0)
 		return minor;
 
+	minor *= BCACHE_MINORS;
+
 	if (!(d->bio_split = bioset_create(4, offsetof(struct bbio, bio))) ||
-	    !(d->disk = alloc_disk(1))) {
+	    !(d->disk = alloc_disk(BCACHE_MINORS))) {
 		ida_simple_remove(&bcache_minor, minor);
 		return -ENOMEM;
 	}
